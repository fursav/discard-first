<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN"
 "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">  
  <title>Ajax with jQuery - using YQL</title>
  <link rel="stylesheet" href="styles.css" type="text/css">
</head>
<body>
<div id="doc" class="yui-t7">
  <div id="hd" role="banner"><h1>Ajax with jQuery - using YQL</h1></div>
  <div id="bd" role="main">
    <h2>Demo</h2>
    <ul>
      <li><input id="input"></li>
      <li><button onClick='startAjax();'>Load</button></li>
      <li><a href="http://www.boardgamegeek.com/xmlapi/search?search=Crossbows%20and%20Catapults" class="ajaxtrigger">Load Ajax Content</a></li>
      <li><a href="http://developer.yahoo.com" class="ajaxtrigger">Get developer.yahoo.com</a></li>
    </ul>
    <div id="target"></div>
    <h2>Source Code</h2>
    <div id="code"></div>
    <ul id="nav"><li><a href="error-handling.html">Adding error handling and effects</a></li></ul>
  </div>
  <div id="ft" role="contentinfo"><p>Written by <a href="http://wait-till-i.com/index.php">Christian Heilmann</a>.</p></div>
</div>
<script src="http://code.jquery.com/jquery-latest.pack.js"></script>
<script src="code.js"></script>
<script src="using-yql.js"></script>
<script type="text/javascript">
  function startAjax() {
      doAjax('http://www.boardgamegeek.com/xmlapi/search?search='+$('#input').val());  
  }
  function doAjax(url){
    var container = $('#target');
    if(url.match('^http')){
      $.getJSON("http://query.yahooapis.com/v1/public/yql?"+
                "q=select%20*%20from%20xml%20where%20url%3D%22"+
                encodeURIComponent(url)+
                "%22&format=xml'&callback=?",
        function(data){
          if(data.results[0]){
            var data = filterData(data.results[0]);
            container.html(data);
          } else {
            var errormsg = '<p>Error: could not load the page.</p>';
            container.html(errormsg);
          }
        }
      );
    } else {
      $('#target').load(url);
    }
  }
  function filterData(data){
    data = data.replace(/<?\/body[^>]*>/g,'');
    data = data.replace(/[\r|\n]+/g,'');
    data = data.replace(/<--[\S\s]*?-->/g,'');
    data = data.replace(/<noscript[^>]*>[\S\s]*?<\/noscript>/g,'');
    data = data.replace(/<script[^>]*>[\S\s]*?<\/script>/g,'');
    data = data.replace(/<script.*\/>/,'');
    return data;
  }
</script>
</body>
</html>
